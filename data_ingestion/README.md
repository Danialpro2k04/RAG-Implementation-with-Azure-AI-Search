# ðŸ· Wine Data Ingestion & Console RAG Tester

This directory contains the standalone ETL (Extract, Transform, Load) script. Unlike the main **Web App** (which provides a user interface), this script is responsible for **populating the Azure AI Search index** with data from a CSV file and performing a "sanity check" on the RAG pipeline via the terminal.

## ðŸ†š How is this different from the Web App?

| Feature | **Web App** (Other Project) | **Data Ingestion** (This Project) |
| :--- | :--- | :--- |
| **Purpose** | Serves user queries via HTTP API/UI. | Loads data and creates vector embeddings. |
| **Input** | User questions via API Request. | Static `wine-ratings.csv` file. |
| **Output** | JSON Response to Frontend. | Console Logs & Database updates. |
| **Usage** | Runs permanently as a server (FastAPI). | Runs once to "hydrate" the database. |

## âš™ï¸ What this script does

1.  **Environment Check:** Verifies all Azure keys and endpoints are configured.
2.  **Vector Store Connection:** Connects to Azure AI Search.
3.  **Data Loading:** Reads the local `wine-ratings.csv` file.
4.  **Chunking:** Splits the text into 1000-character chunks for better retrieval.
5.  **Indexing:** Embeds the text using Azure OpenAI (Embeddings model) and uploads it to Azure AI Search.
6.  **Console Verification:** Immediately runs a hardcoded test query ("Best Cabernet Sauvignon...") and generates a GPT-4 response to prove the system is working correctly.

## ðŸ› ï¸ Requirements

Ensure you have a `.env` file in this directory with the same credentials used in the web app.

*   `AZURE_OPENAI_ENDPOINT`
*   `AZURE_OPENAI_API_KEY`
*   `SEARCH_SERVICE_NAME`
*   etc...

## ðŸš€ Usage

1.  **Prepare Data:**
    Ensure `wine-ratings.csv` is present in this folder.

2.  **Install Dependencies:**
    ```bash
    pip install langchain langchain-community langchain-openai azure-search-documents openai python-dotenv
    ```

3.  **Run the Ingestion:**
    ```bash
    python ingest.py
    ```

## ðŸ“ Expected Output

When you run the script, you will see the following stages in your terminal:

1.  `Attempting to load environment variables...`
2.  `Adding X documents to the Azure Cognitive Search index...`
3.  **Retrieval Test:** It will print the raw text of the top matching document found in the vector store.
4.  **RAG Response:** It will print a final, natural language answer generated by the LLM based on the CSV data.

> **Note:** run this script whenever your CSV data changes to update the search index.
